# Everything Chrome Extension

> 一个功能强大的 Chrome 浏览器扩展，让你在浏览器中无缝、快速地调用本地 Everything 搜索文件。

使用 **Plasmo** 框架、**TypeScript**、**Vue 3** 和 **Element Plus** 构建。界面友好，功能完善，已全面汉化。

---

## ✨ 核心特性

### 🔍 多种搜索方式
- **右键菜单搜索**：选中网页上的任意文本，右键直接搜索本地文件
- **快捷弹窗搜索**：点击扩展图标，在弹出框中快速输入关键词搜索
- **智能关键词解析**：自动识别空格、横杠、下划线分隔的关键词，支持中英文混合搜索

### 🎯 智能页面集成
- **JavDB 自动识别**：在 JavDB 详情页，自动识别番号并添加 **"搜本地"** 快捷按钮
- **批量检测**：在 JavDB 演员页面等列表页，**自动批量检测**所有影片的本地存储状态，并显示 **"本地"** 角标
- **悬停预览**：鼠标悬停在本地角标上，自动显示搜索结果列表
- **站点白名单**：支持配置特定站点生效，避免不必要的资源消耗

### 🎨 现代化 UI
- **Glassmorphism 风格**：采用毛玻璃效果的深色主题弹窗
- **智能定位**：搜索结果卡片支持拖拽，自动碰撞检测，智能定位避免超出屏幕
- **响应式设计**：适配不同屏幕尺寸，自动调整位置
- **完全汉化**：全中文界面和代码注释

### ⚙️ 丰富的配置选项
- **连接配置**：灵活配置 Everything HTTP 服务地址和端口
- **搜索行为**：支持区分大小写、全字匹配、正则表达式、匹配路径等多种搜索策略
- **结果控制**：可配置结果数量限制、排序方式、返回字段等
- **自动打开**：可选择是否自动打开搜索结果卡片

---

## 🚀 快速开始

### 前置要求

1. **Everything 软件**：确保已安装并运行 [Everything](https://www.voidtools.com/)
2. **Chrome 浏览器**：Chrome 88+ 或基于 Chromium 的浏览器（Edge、Brave 等）
3. **Node.js**：Node.js 16+ 和 npm（用于开发构建）

### 安装步骤

#### 1. 克隆项目

```bash
git clone <repository-url>
cd everything-chrome-ext
```

#### 2. 安装依赖

```bash
npm install
```

#### 3. 构建扩展

```bash
# 开发模式（支持热重载）
npm run dev

# 生产构建
npm run build
```

#### 4. 加载到 Chrome

1. 打开 Chrome 浏览器，访问 `chrome://extensions`
2. 启用右上角的 **"开发者模式"**
3. 点击 **"加载已解压的扩展程序"**
4. 选择项目目录下的 `build/chrome-mv3-dev` 文件夹（开发模式）或 `build/chrome-mv3-prod` 文件夹（生产构建）

#### 5. 关键配置（重要！）

由于本插件需要访问本地文件和识别特殊页面，请务必：

1. 在 Chrome 扩展管理页，找到本插件，点击 **"详细信息"**
2. 开启 **"允许访问文件网址" (Allow access to file URLs)**
3. 确保本地 **Everything** 服务已启动并配置了 CORS（见下文）

---

## 🔧 配置 Everything HTTP 服务

插件依赖本地运行的 Everything HTTP 服务。请按照以下步骤配置：

### 1. 启用 HTTP Server

1. 打开 Everything 软件
2. 菜单栏：`工具` → `选项`
3. 左侧导航：`HTTP 服务器` → 勾选 `启用 HTTP 服务器` (Enable HTTP server)
4. 记下端口号（默认 80 或自定义，例如 8181）

### 2. 配置 CORS（跨域访问）

为了允许浏览器插件访问本地服务，必须配置跨域支持：

1. 找到 `Everything.ini` 配置文件
   - 通常在 Everything 安装目录
   - 或在 `%APPDATA%\Everything` 目录
2. 使用文本编辑器打开 `Everything.ini`
3. 找到 `[HTTP Server]` 部分（如果没有则创建）
4. 添加或修改以下行：
   ```ini
   http_server_header=Access-Control-Allow-Origin: *
   ```
5. **保存文件并重启 Everything** 以生效

### 3. 在插件中配置连接

1. 右键点击浏览器右上角的 Everything 扩展图标 → `选项`
2. 在设置页面配置：
   - **协议**：http 或 https（通常选择 http）
   - **主机**：`127.0.0.1`（本地服务）
   - **端口**：与 Everything 中配置的端口一致（例如 `8181`）
3. 点击 **"测试连接状态"** 验证配置是否正确
4. 点击 **"保存当前配置"** 保存设置

---

## 📁 项目结构

```
everything-chrome-ext/
├── src/
│   ├── background.ts              # 后台服务脚本（处理右键菜单、消息转发）
│   ├── contents/
│   │   ├── content.ts             # 内容脚本（页面注入、自动搜索逻辑）
│   │   └── styles/
│   │       └── card.css          # 搜索结果弹窗样式（深色主题）
│   ├── components/
│   │   └── SearchResultList.vue   # 搜索结果列表组件
│   ├── popup.vue                  # Popup 弹窗页面（Vue 3）
│   ├── options.vue                # 设置页面（Vue 3 + Element Plus）
│   ├── styles/
│   │   ├── popup.css              # Popup 样式
│   │   └── options.css            # Options 样式
│   └── utils/
│       ├── card.ts                # 弹窗 UI 类（拖拽、定位、显示逻辑）
│       ├── config.ts              # 配置管理（存储、读取配置）
│       ├── search.ts              # Everything API 封装（搜索、格式化）
│       └── element-plus.ts        # Element Plus 组件注册
├── assets/
│   └── icon.png                   # 扩展图标
├── doc/                           # 项目文档
│   ├── ARCHITECTURE.md            # 架构文档
│   ├── DEVELOPMENT.md             # 开发指南
│   ├── PROJECT_GUIDE.md           # 项目指南
│   └── ...
├── plasmo.config.ts               # Plasmo 框架配置
├── package.json                   # 项目依赖和脚本
├── tsconfig.json                  # TypeScript 配置
└── README.md                      # 本文件
```

---

## 🛠️ 开发与构建

### 开发模式

```bash
npm run dev
```

启动开发服务器，支持热重载。修改代码后会自动重新构建。

### 生产构建

```bash
npm run build
```

构建生产版本，输出到 `build/chrome-mv3-prod` 目录。

### 打包发布

```bash
npm run package
```

生成可发布的 `.zip` 文件，可直接上传到 Chrome Web Store。

---

## 📖 使用说明

### 右键菜单搜索

1. 在任意网页上选中文本
2. 右键点击选中的文本
3. 选择 **"使用 Everything 搜索"**
4. 搜索结果会以浮动卡片的形式显示在页面上

### Popup 弹窗搜索

1. 点击浏览器右上角的扩展图标
2. 在搜索框中输入关键词
3. 点击 **"Go"** 按钮或按 `Enter` 键
4. 搜索结果会显示在弹窗中

### JavDB 页面集成

#### 详情页功能

- 自动识别页面中的番号
- 在番号旁边添加 **"搜本地"** 按钮
- 如果本地已存在，按钮会变为 **"本地已有"**（绿色）
- 点击按钮即可搜索本地文件

#### 列表页功能

- 自动批量检测页面中所有影片的本地存储状态
- 在已存在的影片封面上显示 **"本地"** 角标
- 鼠标悬停在角标上，会显示搜索结果列表
- 移开鼠标后，列表会自动隐藏

### 配置选项

访问扩展设置页面，可以配置：

- **基础连接**：协议、主机、端口
- **搜索行为**：区分大小写、全字匹配、正则表达式等
- **结果控制**：数量限制、排序方式、返回字段
- **站点白名单**：配置仅在特定站点生效
- **自动打开**：是否自动打开搜索结果卡片

---

## 🐛 常见问题

### Q: 为什么搜索没有反应？

**A:** 请检查以下几点：

1. **Everything 服务状态**
   - 确认 Everything 软件正在运行
   - 确认已启用 HTTP 服务器
   - 在扩展设置页面点击 **"测试连接状态"** 验证连接

2. **CORS 配置**
   - 确认 `Everything.ini` 中已添加 `http_server_header=Access-Control-Allow-Origin: *`
   - 确认已重启 Everything 软件

3. **扩展配置**
   - 确认扩展设置中的端口地址与 Everything 配置一致
   - 确认已开启 **"允许访问文件网址"** 权限

### Q: JavDB 页面没有显示按钮或角标？

**A:** 请尝试以下方法：

1. **刷新页面**：按 `F5` 或 `Ctrl+R` 刷新页面
2. **检查站点白名单**：确认当前站点在设置的白名单中（如果配置了白名单）
3. **检查文件访问权限**：如果是本地 HTML 文件，确保在扩展设置中开启了 **"允许访问文件网址"**
4. **查看控制台**：按 `F12` 打开开发者工具，查看 Console 中是否有错误信息

### Q: 搜索结果卡片位置不合适？

**A:** 卡片支持拖拽功能：

- 点击并拖动卡片头部（标题栏）可以移动卡片位置
- 卡片会自动检测屏幕边界，避免超出可视区域
- 下次打开时会记住上次的位置

### Q: 如何修改搜索结果数量限制？

**A:** 在扩展设置页面：

1. 找到 **"结果数量限制"** 选项
2. 输入期望的数量（1-1000）
3. 点击 **"保存当前配置"**

### Q: 如何只在特定网站生效？

**A:** 在扩展设置页面：

1. 找到 **"生效站点白名单"** 部分
2. 输入域名（例如：`javdb.com`）
3. 点击 **"添加站点"**
4. 保存配置后，插件仅在列表中的站点生效
5. 如果列表为空，插件会在所有站点生效

---

## 🔒 安全与隐私

- **本地搜索**：所有搜索请求都在本地完成，不会发送到任何远程服务器
- **数据存储**：配置信息仅存储在浏览器本地，不会上传
- **权限最小化**：仅请求必需的权限（右键菜单、存储、标签页访问）
- **XSS 防护**：所有用户输入都经过 HTML 转义处理，防止注入攻击

---

## 📄 许可证

MIT License

---

## 🙏 致谢

- [Plasmo](https://www.plasmo.com/) - 优秀的浏览器扩展开发框架
- [Everything](https://www.voidtools.com/) - 强大的本地文件搜索工具
- [Vue.js](https://vuejs.org/) - 渐进式 JavaScript 框架
- [Element Plus](https://element-plus.org/) - 基于 Vue 3 的组件库

---

## 📝 更新日志

### v1.0.0 (2026-02-03)

- ✨ 初始版本发布
- ✨ 支持右键菜单搜索
- ✨ 支持 Popup 弹窗搜索
- ✨ JavDB 页面自动识别和批量检测
- ✨ 搜索结果卡片拖拽和智能定位
- ✨ 完整的配置选项和设置页面
- ✨ 站点白名单功能
- ✨ 自动打开卡片选项

---

**最后更新**：2026-02-03  
**版本**：1.0.0  
